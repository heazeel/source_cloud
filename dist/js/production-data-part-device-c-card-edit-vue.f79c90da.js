(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["production-data-part-device-c-card-edit-vue"],{3158:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("drawer-right",{staticClass:"ccard-edit",attrs:{title:"通信卡"+e.action.title,width:"800px","submit-func":e.handleSubmit},on:{open:e.init,cancel:function(t){return e.$router.back()}}},[r("el-form",{ref:"form",staticClass:"form-drawer",attrs:{rules:e.rules,model:e.form,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubmit(t)}}},[r("el-form-item",{attrs:{label:"卡号",prop:"card_no",rules:[{required:!0,message:"请输入卡号"},e.$tools.formRules.code,e.$tools.formRules.repeatCheck({value:e.form.code,id:e.form.id,module:"communicationcard",field:"card_no"})]}},[r("el-input",{attrs:{placeholder:"请输入数字、字母组合"},model:{value:e.form.card_no,callback:function(t){e.$set(e.form,"card_no",t)},expression:"form.card_no"}})],1),r("el-form-item",{attrs:{label:"运营商",prop:"provider"}},[r("el-select",{attrs:{placeholder:"请选择运营商"},on:{change:e.getTotal},model:{value:e.form.provider,callback:function(t){e.$set(e.form,"provider",t)},expression:"form.provider"}},e._l(e.PROVIDER_TYPE,(function(e){return r("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1)],1),r("el-form-item",{attrs:{label:"价格",prop:"price"}},[r("el-input",{attrs:{placeholder:"请输入大于0的数字"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1),r("el-form-item",{attrs:{label:"当前设备",prop:"device_id"}},[r("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"类别",clearable:""},on:{change:e.clearDeviceId,clear:e.hideSelectionBox},model:{value:e.form.device_type,callback:function(t){e.$set(e.form,"device_type",t)},expression:"form.device_type"}},e._l(e.DEV_TYPE,(function(e){return r("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1),null!==e.form.device_type?r("select-remote",{staticStyle:{width:"calc(100% - 120px)"},attrs:{"label-key":"no",params:{device_type:e.form.device_type},"api-key-obj":{type:"cCard",funcName:"remoteSelectSearch"},placeholder:"编号",clearable:""},model:{value:e.form.device_id,callback:function(t){e.$set(e.form,"device_id",t)},expression:"form.device_id"}}):e._e()],1),r("el-form-item",{attrs:{label:"套餐总量"}},[e._v(" "+e._s(e._f("kbToMb")(e.total.package_total_sum))+" M ")]),r("el-form-item",{attrs:{label:"剩余流量"}},[e._v(" "+e._s(e._f("kbToMb")(e.total.remaining_flow_sum))+" M ")]),r("el-form-item",{attrs:{label:"已用流量"}},[e._v(" "+e._s(e._f("kbToMb")(e.total.used_flow_sum))+" M ")]),r("el-form-item",{attrs:{label:"昨天使用流量"}},[e._v(" "+e._s(e._f("kbToMb")(e.total.yesterday_use_flow_sum))+" M ")]),r("el-form-item",{attrs:{label:"供应商",prop:"supplier"}},[r("el-select",{attrs:{placeholder:"请选择供应商"},on:{change:e.getTotal},model:{value:e.form.supplier,callback:function(t){e.$set(e.form,"supplier",t)},expression:"form.supplier"}},e._l(e.SUPPLIER_TYPE,(function(e){return r("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1)],1),r("el-form-item",{attrs:{prop:"flow_pool_id",label:"流量池"}},[r("select-remote",{attrs:{label:e.form.flow_pool,"api-key-obj":{type:"flowPool",funcName:"remoteSelectSearch"},placeholder:"请选择流量池"},on:{input:e.getTotal},model:{value:e.form.flow_pool_id,callback:function(t){e.$set(e.form,"flow_pool_id",t)},expression:"form.flow_pool_id"}})],1),r("el-form-item",{attrs:{prop:"purchase_time",label:"采购时间"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"timestamp",editable:!1,placeholder:"选择日期"},model:{value:e.form.purchase_time,callback:function(t){e.$set(e.form,"purchase_time",t)},expression:"form.purchase_time"}})],1),r("el-form-item",{attrs:{prop:"status",label:"状态"}},[r("el-select",{attrs:{placeholder:"状态"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.DEV_C_CARD_LIFE_STATUS,(function(e){return r("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1)],1),r("el-form-item",{staticClass:"block",attrs:{label:"备注",prop:"comment"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1)],1)],1)},a=[],l=(r("96cf"),r("1da1")),n=r("5530"),i=r("d7f3"),c=r("4c6b"),s={create:{title:"新建",type:"create",submitFunc:i["create"]},update:{title:"修改",type:"update",submitFunc:i["update"]}},u={card_no:null,supplier:null,price:null,device_type:null,device_id:null,provider:null,flow_pool_id:null,purchase_time:null,status:null,comment:null},m={name:"CCardEdit",data:function(){return{action:s.create,form:this.$lodash.cloneDeep(u),rules:{card_no:[{required:!0,message:"请输入卡号"},this.$tools.formRules.code,this.$tools.formRules.repeatCheck({value:u.code,id:u.id,module:"communicationcard",field:"card_no"})],provider:[{required:!0,message:"请选择运营商"}],supplier:[{required:!0,message:"请选择供应商"}],price:[{required:!0,message:"请输入价格"},this.$tools.formRules.numberMoreThan()],flow_pool_id:[{required:!0,message:"请选择流量池"}],purchase_time:[{required:!0,message:"请选择时间"}],status:[{required:!0,message:"请选择状态"}],comment:[{required:!0,message:"请输入备注"}]},total:{package_total_sum:null,remaining_flow_sum:null,used_flow_sum:null,yesterday_use_flow_sum:null},SUPPLIER_TYPE:c["l"],PROVIDER_TYPE:c["k"],DEV_C_CARD_LIFE_STATUS:c["f"],DEV_TYPE:c["h"]}},watch:{"$route.query.id":{handler:function(e){this.action=e||0===e?Object(n["a"])({},s.update,{id:e}):s.create},immediate:!0}},methods:{init:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("create"!==e.action.type){t.next=5;break}e.form=e.$lodash.cloneDeep(u),e.form.purchase_time=Date.parse(new Date),t.next=15;break;case 5:if("update"!==e.action.type){t.next=15;break}return t.next=8,Object(i["detailSearch"])({id:e.action.id},{loading:!0});case 8:if(r=t.sent,200===r.code){t.next=12;break}return e.form=e.$lodash.cloneDeep(u),t.abrupt("return");case 12:e.form=r.content,e.form.purchase_time=parseInt(1e3*r.content.purchase_time),e.getTotal();case 15:case"end":return t.stop()}}),t)})))()},handleSubmit:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.form.validate();case 3:if(r=t.sent,r){t.next=6;break}return t.abrupt("return");case 6:return o={card_no:e.form.card_no,provider:e.form.provider,price:e.form.price,device_type:e.form.device_type,device_id:e.form.device_id,supplier:e.form.supplier,flow_pool_id:e.form.flow_pool_id,purchase_time:parseInt(e.form.purchase_time/1e3),status:e.form.status,comment:e.form.comment},"update"===e.action.type&&(o.id=e.form.id),t.next=10,e.action.submitFunc(o,{loading:!0});case 10:if(a=t.sent,200===a.code){t.next=13;break}return t.abrupt("return");case 13:e.$message({message:"".concat(e.action.title,"成功！"),type:"success",containerType:"drawer",onClose:function(){e.$router.back()}}),t.next=19;break;case 16:return t.prev=16,t.t0=t["catch"](0),t.abrupt("return",t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))()},getTotal:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["totalSearch"])({card_no:e.form.card_no,provider:e.form.provider,supplier:e.form.supplier,flow_pool_id:e.form.flow_pool_id},{loading:!0});case 2:if(r=t.sent,200==r.code){t.next=5;break}return t.abrupt("return");case 5:e.total=r.content;case 6:case"end":return t.stop()}}),t)})))()},clearDeviceId:function(){this.form.device_id=null},hideSelectionBox:function(){this.form.device_id=null,this.form.device_type=null}}},p=m,d=r("2877"),f=Object(d["a"])(p,o,a,!1,null,null,null);t["default"]=f.exports}}]);