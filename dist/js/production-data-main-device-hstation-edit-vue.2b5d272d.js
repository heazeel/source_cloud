(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["production-data-main-device-hstation-edit-vue"],{6693:function(t,e,a){"use strict";a.d(e,"a",(function(){return n}));a("fb6a"),a("a434");var r=a("4c6b"),n={watch:{"$route.query":{handler:function(t){t.id||0===t.id?3!==t.status&&4!==t.status?this.statusArr=r["g"].slice(0,2):3===t.status?this.statusArr=r["g"].slice(2,3):4===t.status&&(this.statusArr=r["g"],this.statusArr.splice(-2,1)):this.statusArr=r["g"].slice(0,2)},immediate:!0}}}},fc8c:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("drawer-right",{staticClass:"hstation-edit",attrs:{title:"人工站"+t.action.title,width:"700px","submit-func":t.handleSubmit},on:{open:t.init,cancel:function(e){return t.$router.back()}}},[a("el-form",{ref:"form",staticClass:"form-drawer",attrs:{rules:t.rules,model:t.form,"label-width":"90px"},nativeOn:{submit:function(t){t.preventDefault()},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSubmit(e)}}},[a("el-form-item",{attrs:{label:"产品编号",prop:"code"}},[a("el-input",{attrs:{disabled:"create"!=t.action.type,placeholder:"请输入数字"},model:{value:t.form.code,callback:function(e){t.$set(t.form,"code",e)},expression:"form.code"}})],1),a("el-form-item",{attrs:{label:"所属企业",prop:"company"}},[t._v(" "+t._s(t.form.company)+" ")]),a("el-form-item",{attrs:{label:"产品状态",prop:"status"}},[a("el-select",{attrs:{placeholder:"请选择状态"},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},t._l(t.statusArr,(function(t){return a("el-option",{key:t.key,attrs:{label:t.text,value:t.key}})})),1)],1),a("el-form-item",{staticClass:"block",attrs:{"label-width":"0"}},[a("set-tarmacs",{ref:"tarmacs-form",attrs:{type:"hstation",form:t.form},on:{"add-item":t.addTarmacsItem,"delete-item":t.deleteTarmacsItem,"form-valid":function(e){t.tarmacsValid=arguments[0]}}})],1)],1)],1)},n=[],s=(a("d81d"),a("a434"),a("a9e3"),a("d3b7"),a("96cf"),a("1da1")),i=a("5530"),c=a("3d4f"),o=a("6693"),u={create:{title:"新建",type:"create",submitFunc:c["create"]},update:{title:"修改",type:"update",submitFunc:c["update"]}},l=[{no:"",angle:0,fall_type:2,identify_type:1,retry_times:0,usage_scenario:3,vision_feature:1}],m={code:null,status:null,tarmacs:l},d={name:"UstationEdit",components:{"set-tarmacs":function(){return a.e("production-data-main-device-common-set-tarmacs-vue").then(a.bind(null,"32bc"))}},mixins:[o["a"]],data:function(){return{action:u.create,form:this.$lodash.cloneDeep(m),rules:{code:[{required:!0,message:"请输入产品编号"},this.$tools.formRules.default]},statusArr:[]}},watch:{"$route.query.id":{handler:function(t){this.action=t||0===t?Object(i["a"])({},u.update,{id:t}):u.create},immediate:!0}},methods:{init:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("create"!==t.action.type){e.next=4;break}t.form=t.$lodash.cloneDeep(m),e.next=12;break;case 4:if("update"!==t.action.type){e.next=12;break}return e.next=7,Object(c["detailSearch"])({id:t.action.id},{loading:!0});case 7:if(a=e.sent,200===a.code){e.next=11;break}return t.form=t.$lodash.cloneDeep(m),e.abrupt("return");case 11:t.form=a.content;case 12:case"end":return e.stop()}}),e)})))()},handleSubmit:function(){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a,r,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$refs.form.validate();case 3:if(a=e.sent,a){e.next=6;break}return e.abrupt("return");case 6:return r={code:t.form.code,status:t.form.status},t.form.tarmacs.map((function(t){return t.angle=Number(t.angle),t})),r.tarmacs=JSON.stringify(t.form.tarmacs),"update"===t.action.type&&(r.id=t.form.id),e.next=12,t.action.submitFunc(r,{loading:!0});case 12:if(n=e.sent,200===n.code){e.next=15;break}return e.abrupt("return");case 15:t.$message({message:"".concat(t.action.title,"成功！"),type:"success",containerType:"drawer",onClose:function(){t.$router.back()}}),e.next=21;break;case 18:return e.prev=18,e.t0=e["catch"](0),e.abrupt("return",e.t0);case 21:case"end":return e.stop()}}),e,null,[[0,18]])})))()},addTarmacsItem:function(){if(this.form.tarmacs||this.$set(this.form,"tarmacs",[]),this.form.tarmacs.length>=1)return this.$message({type:"warning",message:"最多只能设置一个停机位"});var t=this.$lodash.cloneDeep(l);this.form.tarmacs.push(t)},deleteTarmacsItem:function(t){if(this.form.tarmacs.length<=1)return this.$message({type:"warning",message:"必须有一个停机位，并且有且仅有一个"});this.form.tarmacs.splice(t.index,1)}}},f=d,p=a("2877"),h=Object(p["a"])(f,r,n,!1,null,null,null);e["default"]=h.exports}}]);