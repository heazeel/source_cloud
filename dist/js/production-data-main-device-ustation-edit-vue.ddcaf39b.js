(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["production-data-main-device-ustation-edit-vue"],{4570:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("drawer-right",{staticClass:"ustation-edit",attrs:{title:"无人站"+e.action.title,width:"700px","submit-func":e.handleSubmit},on:{open:e.init,cancel:function(t){return e.$router.back()}}},[r("el-form",{ref:"form",staticClass:"form-drawer",attrs:{rules:e.rules,model:e.form,"label-width":"90px"},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubmit(t)}}},[r("el-form-item",{attrs:{label:"序号",prop:"no"}},[r("el-input",{attrs:{disabled:"create"!=e.action.type,placeholder:"请输入数字"},model:{value:e.form.no,callback:function(t){e.$set(e.form,"no",t)},expression:"form.no"}})],1),r("el-form-item",{attrs:{label:"产品编号",prop:"code"}},[r("el-input",{attrs:{disabled:"create"!=e.action.type,placeholder:"请输入数字"},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}})],1),r("el-form-item",{attrs:{label:"所属企业",prop:"company"}},[e._v(" "+e._s(e.form.company)+" ")]),r("el-form-item",{attrs:{label:"型号",prop:"model"}},[e._v(" RH1 ")]),r("el-form-item",{attrs:{label:"产品状态",prop:"status"}},[r("el-select",{attrs:{placeholder:"请选择状态"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.statusArr,(function(e){return r("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1)],1),r("el-form-item",{attrs:{label:"内部型号",prop:"internal_model"}},[r("el-input",{model:{value:e.form.internal_model,callback:function(t){e.$set(e.form,"internal_model",t)},expression:"form.internal_model"}})],1),r("el-form-item",{attrs:{label:"固件版本",prop:"version_no"}},[e._v(" "+e._s(e.form.version_no)+" ")]),r("el-form-item",{staticClass:"block",attrs:{label:"摄像头标定",prop:"ref_line_file"}},[r("upload-file",{attrs:{accept:".xlsx, .xls","file-lists":e.fileList},on:{"on-change":e.handleFileChange},scopedSlots:e._u([{key:"other",fn:function(){return[r("el-col",{staticClass:"form-operate-text color-primary",staticStyle:{cursor:"pointer"},attrs:{span:6}},[r("span",[e._v("下载模板")])])]},proxy:!0}])})],1),r("el-form-item",{staticClass:"block",attrs:{label:"备注",prop:"comment"}},[r("el-input",{attrs:{type:"textarea",placeholder:"请输入备注"},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1),r("el-form-item",{staticClass:"block",attrs:{"label-width":"0"}},[r("set-tarmacs",{ref:"tarmacs-form",attrs:{type:"ustation",form:e.form},on:{"add-item":e.addTarmacsItem,"delete-item":e.deleteTarmacsItem,"form-valid":function(t){e.tarmacsValid=arguments[0]}}})],1)],1)],1)},n=[],o=(r("99af"),r("d81d"),r("a434"),r("b0c0"),r("a9e3"),r("d3b7"),r("96cf"),r("1da1")),s=r("5530"),i=r("6693"),l=r("9e8c"),c={create:{title:"新建",type:"create",submitFunc:l["create"]},update:{title:"修改",type:"update",submitFunc:l["update"]}},m=[{id:null,no:"",angle:0,fall_type:4,identify_type:1,retry_times:0,usage_scenario:3,vision_feature:2}],u={no:null,code:null,status:null,internal_model:null,ref_line_file:null,ref_line_file_name:null,tarmacs:m,comment:null},f={name:"UstationEdit",components:{"upload-file":function(){return r.e("production-data-main-device-common-upload-file-vue").then(r.bind(null,"9e8a"))},"set-tarmacs":function(){return r.e("production-data-main-device-common-set-tarmacs-vue").then(r.bind(null,"32bc"))}},mixins:[i["a"]],data:function(){return{action:c.create,form:this.$lodash.cloneDeep(u),rules:{no:[{required:!0,message:"请输入序号"},this.$tools.formRules.pureNumber],code:[{required:!0,message:"请输入产品编号"},this.$tools.formRules.default],status:[{required:!0,message:"请选择产品状态"}],internal_model:[this.$tools.formRules.default],comment:[this.$tools.formRules.default]},statusArr:[]}},computed:{fileList:function(){return this.form.ref_line_file_name&&[{name:this.form.ref_line_file_name,downloadUrl:"".concat(l["cameraFileDownload"],"token=").concat(localStorage.getItem("token"),"&id=").concat(this.$route.query.id)}]||[]}},watch:{"$route.query.id":{handler:function(e){this.action=e||0===e?Object(s["a"])({},c.update,{id:e}):c.create},immediate:!0}},methods:{init:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("create"!==e.action.type){t.next=4;break}e.form=e.$lodash.cloneDeep(u),t.next=12;break;case 4:if("update"!==e.action.type){t.next=12;break}return t.next=7,Object(l["detailSearch"])({id:e.action.id},{loading:!0});case 7:if(r=t.sent,200===r.code){t.next=11;break}return e.form=e.$lodash.cloneDeep(u),t.abrupt("return");case 11:e.form=r.content;case 12:case"end":return t.stop()}}),t)})))()},handleSubmit:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var r,a,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$refs["tarmacs-form"].submitForm();case 2:return r=t.sent,t.prev=3,t.next=6,e.$refs.form.validate();case 6:if(a=t.sent,r&&a){t.next=9;break}return t.abrupt("return");case 9:return n=new FormData,n.append("no",Number(e.form.no)),n.append("code",e.form.code),n.append("status",e.form.status),n.append("internal_model",e.form.internal_model),n.append("comment",e.form.comment),e.form.tarmacs.map((function(e){return e.angle=Number(e.angle),e})),n.append("tarmacs",JSON.stringify(e.form.tarmacs)),e.form.ref_line_file&&n.append("ref_line_file",e.form.ref_line_file),"update"===e.action.type&&n.append("id",e.form.id),t.next=22,e.action.submitFunc(n,{loading:!0,formData:!0});case 22:if(o=t.sent,200===o.code){t.next=25;break}return t.abrupt("return");case 25:e.$message({message:"".concat(e.action.title,"成功！"),type:"success",containerType:"drawer",onClose:function(){e.$router.back()}}),t.next=31;break;case 28:return t.prev=28,t.t0=t["catch"](3),t.abrupt("return",t.t0);case 31:case"end":return t.stop()}}),t,null,[[3,28]])})))()},handleFileChange:function(e,t){this.form.ref_line_file=e.raw,this.form.ref_line_file_name=e.name},addTarmacsItem:function(){if(this.form.tarmacs||this.$set(this.form,"tarmacs",[]),this.form.tarmacs.length>=1)return this.$message({type:"warning",message:"最多只能设置一个停机位"});var e=this.$lodash.cloneDeep(m);this.form.tarmacs.push(e)},deleteTarmacsItem:function(e){if(this.form.tarmacs.length<=1)return this.$message({type:"warning",message:"必须有一个停机位，并且有且仅有一个"});this.form.tarmacs.splice(e.index,1)}}},d=f,p=r("2877"),h=Object(p["a"])(d,a,n,!1,null,null,null);t["default"]=h.exports},6693:function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));r("fb6a"),r("a434");var a=r("4c6b"),n={watch:{"$route.query":{handler:function(e){e.id||0===e.id?3!==e.status&&4!==e.status?this.statusArr=a["g"].slice(0,2):3===e.status?this.statusArr=a["g"].slice(2,3):4===e.status&&(this.statusArr=a["g"],this.statusArr.splice(-2,1)):this.statusArr=a["g"].slice(0,2)},immediate:!0}}}}}]);