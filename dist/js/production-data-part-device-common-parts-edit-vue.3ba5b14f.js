(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["production-data-part-device-common-parts-edit-vue"],{"07ac":function(e,t,i){var n=i("23e7"),a=i("6f53").values;n({target:"Object",stat:!0},{values:function(e){return a(e)}})},"08a9":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("transition",{attrs:{name:"viewer-fade"}},[i("div",{ref:"el-image-viewer__wrapper",staticClass:"el-image-viewer__wrapper",style:{"z-index":e.zIndex},attrs:{tabindex:"-1"}},[i("div",{staticClass:"el-image-viewer__mask"}),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__close",on:{click:e.hide}},[i("i",{staticClass:"el-icon-circle-close"})]),e.isSingle?e._e():[i("span",{staticClass:"el-image-viewer__btn el-image-viewer__prev",class:{"is-disabled":!e.infinite&&e.isFirst},on:{click:e.prev}},[i("i",{staticClass:"el-icon-arrow-left"})]),i("span",{staticClass:"el-image-viewer__btn el-image-viewer__next",class:{"is-disabled":!e.infinite&&e.isLast},on:{click:e.next}},[i("i",{staticClass:"el-icon-arrow-right"})])],i("div",{staticClass:"el-image-viewer__btn el-image-viewer__actions"},[i("div",{staticClass:"el-image-viewer__actions__inner"},[i("i",{staticClass:"el-icon-zoom-out",on:{click:function(t){return e.handleActions("zoomOut")}}}),i("i",{staticClass:"el-icon-zoom-in",on:{click:function(t){return e.handleActions("zoomIn")}}}),i("i",{staticClass:"el-image-viewer__actions__divider"}),i("i",{class:e.mode.icon,on:{click:e.toggleMode}}),i("i",{staticClass:"el-image-viewer__actions__divider"}),i("i",{staticClass:"el-icon-refresh-left",on:{click:function(t){return e.handleActions("anticlocelise")}}}),i("i",{staticClass:"el-icon-refresh-right",on:{click:function(t){return e.handleActions("clocelise")}}})])]),i("div",{staticClass:"el-image-viewer__canvas"},e._l(e.urlList,(function(t,n){return n===e.index?i("img",{key:t,ref:"img",refInFor:!0,staticClass:"el-image-viewer__img",style:e.imgStyle,attrs:{src:e.currentImg},on:{load:e.handleImgLoad,error:e.handleImgError,mousedown:e.handleMouseDown}}):e._e()})),0)],2)])},a=[],r=(i("99af"),i("c975"),i("a9e3"),i("b680"),i("b64b"),i("07ac"),i("5530")),o=i("526f"),s=i("6bd7"),l={CONTAIN:{name:"contain",icon:"el-icon-full-screen"},ORIGINAL:{name:"original",icon:"el-icon-c-scale-to-original"}},c=Object(s["b"])()?"DOMMouseScroll":"mousewheel",m={name:"elImageViewer",props:{urlList:{type:Array,default:function(){return[]}},zIndex:{type:Number,default:2e3},onSwitch:{type:Function,default:function(){}},onClose:{type:Function,default:function(){}},initialIndex:{type:Number,default:0}},data:function(){return{index:this.initialIndex,isShow:!1,infinite:!0,loading:!1,mode:l.CONTAIN,transform:{scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}},computed:{isSingle:function(){return this.urlList.length<=1},isFirst:function(){return 0===this.index},isLast:function(){return this.index===this.urlList.length-1},currentImg:function(){return this.urlList[this.index]},imgStyle:function(){var e=this.transform,t=e.scale,i=e.deg,n=e.offsetX,a=e.offsetY,r=e.enableTransition,o={transform:"scale(".concat(t,") rotate(").concat(i,"deg)"),transition:r?"transform .3s":"","margin-left":"".concat(n,"px"),"margin-top":"".concat(a,"px")};return this.mode===l.CONTAIN&&(o.maxWidth=o.maxHeight="100%"),o}},watch:{index:{handler:function(e){this.reset(),this.onSwitch(e)}},currentImg:function(e){var t=this;this.$nextTick((function(e){var i=t.$refs.img[0];i.complete||(t.loading=!0)}))}},methods:{hide:function(){this.deviceSupportUninstall(),this.onClose()},deviceSupportInstall:function(){var e=this;this._keyDownHandler=Object(s["c"])((function(t){var i=t.keyCode;switch(i){case 27:e.hide();break;case 32:e.toggleMode();break;case 37:e.prev();break;case 38:e.handleActions("zoomIn");break;case 39:e.next();break;case 40:e.handleActions("zoomOut");break}})),this._mouseWheelHandler=Object(s["c"])((function(t){var i=t.wheelDelta?t.wheelDelta:-t.detail;i>0?e.handleActions("zoomIn",{zoomRate:.015,enableTransition:!1}):e.handleActions("zoomOut",{zoomRate:.015,enableTransition:!1})})),Object(o["e"])(document,"keydown",this._keyDownHandler),Object(o["e"])(document,c,this._mouseWheelHandler)},deviceSupportUninstall:function(){Object(o["d"])(document,"keydown",this._keyDownHandler),Object(o["d"])(document,c,this._mouseWheelHandler),this._keyDownHandler=null,this._mouseWheelHandler=null},handleImgLoad:function(e){this.loading=!1},handleImgError:function(e){this.loading=!1,e.target.alt="加载失败"},handleMouseDown:function(e){var t=this;if(!this.loading&&0===e.button){var i=this.transform,n=i.offsetX,a=i.offsetY,r=e.pageX,l=e.pageY;this._dragHandler=Object(s["c"])((function(e){t.transform.offsetX=n+e.pageX-r,t.transform.offsetY=a+e.pageY-l})),Object(o["e"])(document,"mousemove",this._dragHandler),Object(o["e"])(document,"mouseup",(function(e){Object(o["d"])(document,"mousemove",t._dragHandler)})),e.preventDefault()}},reset:function(){this.transform={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}},toggleMode:function(){if(!this.loading){var e=Object.keys(l),t=Object.values(l),i=t.indexOf(this.mode),n=(i+1)%e.length;this.mode=l[e[n]],this.reset()}},prev:function(){if(!this.isFirst||this.infinite){var e=this.urlList.length;this.index=(this.index-1+e)%e}},next:function(){if(!this.isLast||this.infinite){var e=this.urlList.length;this.index=(this.index+1)%e}},handleActions:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.loading){var i=Object(r["a"])({zoomRate:.2,rotateDeg:90,enableTransition:!0},t),n=i.zoomRate,a=i.rotateDeg,o=i.enableTransition,s=this.transform;switch(e){case"zoomOut":s.scale>.2&&(s.scale=parseFloat((s.scale-n).toFixed(3)));break;case"zoomIn":s.scale=parseFloat((s.scale+n).toFixed(3));break;case"clocelise":s.deg+=a;break;case"anticlocelise":s.deg-=a;break}s.enableTransition=o}}},mounted:function(){this.deviceSupportInstall(),this.$refs["el-image-viewer__wrapper"].focus()}},u=m,d=i("2877"),f=Object(d["a"])(u,n,a,!1,null,null,null);t["a"]=f.exports},"6f53":function(e,t,i){var n=i("83ab"),a=i("df75"),r=i("fc6a"),o=i("d1e7").f,s=function(e){return function(t){var i,s=r(t),l=a(s),c=l.length,m=0,u=[];while(c>m)i=l[m++],n&&!o.call(s,i)||u.push(e?[i,s[i]]:s[i]);return u}};e.exports={entries:s(!0),values:s(!1)}},"857a":function(e,t,i){var n=i("1d80"),a=/"/g;e.exports=function(e,t,i,r){var o=String(n(e)),s="<"+t;return""!==i&&(s+=" "+i+'="'+String(r).replace(a,"&quot;")+'"'),s+">"+o+"</"+t+">"}},9911:function(e,t,i){"use strict";var n=i("23e7"),a=i("857a"),r=i("af03");n({target:"String",proto:!0,forced:r("link")},{link:function(e){return a(this,"a","href",e)}})},"9e66":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("drawer-right",{staticClass:"battery-edit",attrs:{title:"通用零部件"+e.action.title,width:"800px","submit-func":e.handleSubmit},on:{open:e.init,cancel:function(t){return e.$router.back()}}},[i("el-form",{ref:"form",staticClass:"form-drawer",attrs:{model:e.form,rules:e.rules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()},keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSubmit(t)}}},[i("el-form-item",{attrs:{label:"编号",prop:"code"}},[e._v(" "+e._s(e.form.code||"--")+" ")]),i("el-form-item",{attrs:{label:"类别",prop:"type_id"}},[i("select-remote",{attrs:{clearable:"","api-key-obj":{type:"commonParts",funcName:"remoteTypeSelect"}},on:{clear:function(t){return e.clearContent(["model_id","version_id"])},change:function(t){return e.clearContent(["model_id","version_id"])}},model:{value:e.form.type_id,callback:function(t){e.$set(e.form,"type_id",t)},expression:"form.type_id"}})],1),i("el-form-item",{attrs:{label:"原厂",prop:"factory_id"}},[i("select-remote",{attrs:{clearable:"","api-key-obj":{type:"commonParts",funcName:"remoteFactorySelect"}},on:{clear:function(t){return e.clearContent(["factory_code","model_id","version_id"])},change:e.initFactoryCode},model:{value:e.form.factory_id,callback:function(t){e.$set(e.form,"factory_id",t)},expression:"form.factory_id"}})],1),i("el-form-item",{attrs:{label:"型号",prop:"model_id"}},[i("select-remote",{attrs:{"label-key":"code",clearable:"",params:{type_id:e.form.type_id,factory_id:e.form.factory_id},"api-key-obj":{type:"commonParts",funcName:"remoteModelSelect"}},on:{change:function(t){return e.clearContent(["version_id"])},clear:function(t){return e.clearContent(["version_id"])}},model:{value:e.form.model_id,callback:function(t){e.$set(e.form,"model_id",t)},expression:"form.model_id"}})],1),i("el-form-item",{attrs:{label:"原厂编码",prop:"factory_code"}},[e._v(" "+e._s(e.form.factory_code||"--")+" ")]),i("el-form-item",{attrs:{prop:"purchase_time",label:"采购时间"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"timestamp",editable:!1,placeholder:"选择日期"},model:{value:e.form.purchase_time,callback:function(t){e.$set(e.form,"purchase_time",t)},expression:"form.purchase_time"}})],1),i("el-form-item",{attrs:{label:"硬件版本",prop:"version_id"}},[i("select-remote",{attrs:{clearable:"","label-key":"version",params:{type_id:e.form.type_id,factory_id:e.form.factory_id,model_id:e.form.model_id,used:1},"api-key-obj":{type:"commonParts",funcName:"remoteVersionSelect"}},model:{value:e.form.version_id,callback:function(t){e.$set(e.form,"version_id",t)},expression:"form.version_id"}})],1),i("el-form-item",{attrs:{label:"序号",prop:"serial_no"}},[e._v(" "+e._s(e.form.serial_no||"--")+" ")]),i("el-form-item",{attrs:{label:"状态",prop:"status"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.status,callback:function(t){e.$set(e.form,"status",t)},expression:"form.status"}},e._l(e.DEV_C_CARD_LIFE_STATUS,(function(e){return i("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1)],1),i("el-form-item",{attrs:{prop:"last_maintain_time",label:"最近维护"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date","value-format":"timestamp",editable:!1,placeholder:"选择日期"},model:{value:e.form.last_maintain_time,callback:function(t){e.$set(e.form,"last_maintain_time",t)},expression:"form.last_maintain_time"}})],1),i("el-form-item",{attrs:{label:"距下次维护",prop:"remain_day"}},[e._v(" "+e._s(e.form.remain_day||"--")+" 天 ")]),i("el-form-item",{attrs:{label:"距下次维护",prop:"remain_hour"}},[e._v(" "+e._s(e.form.remain_hour||"--")+" h ")]),i("el-form-item",{attrs:{label:"当前设备",prop:"device_id"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"类别",clearable:""},on:{change:function(t){return e.clearContent(["device_id"])},clear:function(t){return e.clearContent(["device_id","device_type"])}},model:{value:e.form.device_type,callback:function(t){e.$set(e.form,"device_type",t)},expression:"form.device_type"}},e._l(e.DEV_TYPE,(function(e){return i("el-option",{key:e.key,attrs:{label:e.text,value:e.key}})})),1),null!==e.form.device_type?i("select-remote",{staticStyle:{width:"calc(100% - 120px)"},attrs:{label:e.form.device_code,params:{device_type:e.form.device_type},"api-key-obj":{type:"commonParts",funcName:"remoteUAVCodeSelect"},placeholder:"编号",clearable:""},model:{value:e.form.device_id,callback:function(t){e.$set(e.form,"device_id",t)},expression:"form.device_id"}}):e._e()],1),i("el-form-item",{staticClass:"block",attrs:{label:"履历本",prop:"resume_book"}},[i("el-input",{attrs:{placeholder:"请输入履历本"},model:{value:e.form.resume_book,callback:function(t){e.$set(e.form,"resume_book",t)},expression:"form.resume_book"}})],1),i("el-form-item",{staticClass:"block",attrs:{label:"贴码位置",prop:"qr_position"}},[i("el-input",{attrs:{placeholder:"请输入贴码位置"},model:{value:e.form.qr_position,callback:function(t){e.$set(e.form,"qr_position",t)},expression:"form.qr_position"}})],1),i("el-form-item",{staticClass:"block uploadItem",attrs:{label:"贴码图片",prop:"qr_img"}},[i("el-upload",{class:{"limit-hide":1==e.imgList.length},attrs:{action:"#","list-type":"picture-card","auto-upload":!1,"on-change":e.handleImgChange,"file-list":e.imgList},scopedSlots:e._u([{key:"file",fn:function(t){var n=t.file;return i("div",{},[i("img",{staticClass:"el-upload-list__item-thumbnail",attrs:{src:n.url,alt:""}}),i("span",{staticClass:"el-upload-list__item-actions"},[i("span",{staticClass:"el-upload-list__item-preview",on:{click:function(t){e.previewImg={visible:!0,urls:[n.url]}}}},[i("i",{staticClass:"el-icon-zoom-in"})]),i("span",{staticClass:"el-upload-list__item-delete",on:{click:function(t){return e.handleRemove(n)}}},[i("i",{staticClass:"el-icon-delete"})])])])}}])},[i("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"})]),i("el-image-viewer",{directives:[{name:"show",rawName:"v-show",value:e.previewImg.visible,expression:"previewImg.visible"}],attrs:{"on-close":function(){return e.previewImg.visible=!1},"url-list":e.previewImg.urls}})],1),i("el-form-item",{staticClass:"block",attrs:{label:"备注",prop:"comment"}},[i("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.form.comment,callback:function(t){e.$set(e.form,"comment",t)},expression:"form.comment"}})],1)],1)],1)},a=[],r=(i("c740"),i("4160"),i("a434"),i("9911"),i("159b"),i("96cf"),i("1da1")),o=i("5530"),s=i("2102"),l=i("4c6b"),c=i("08a9"),m=i("2934"),u={create:{title:"新建",type:"create",submitFunc:s["create"]},update:{title:"修改",type:"update",submitFunc:s["update"]}},d={no:null,type_id:null,model_id:null,factory_id:null,factory_code:null,purchase_time:null,version_id:null,serial_no:null,status:null,last_maintain_time:null,remian_day:null,remian_hour:null,device_type:null,device_id:null,resume_book:null,qr_position:null,qr_img:null,comment:null},f={name:"CommonPartsEdit",components:{"el-image-viewer":c["a"]},data:function(){return{action:u.create,form:this.$lodash.cloneDeep(d),rules:{version_id:[{required:!0,message:"请选择硬件版本"}],purchase_time:[{required:!0,message:"请选择采购时间"}],status:[{required:!0,message:"请选择状态"}]},imgList:[],previewImg:{visible:!1,urls:[]},DEV_C_CARD_LIFE_STATUS:l["f"],DEV_TYPE:l["h"]}},watch:{"$route.query.id":{handler:function(e){this.action=e||0===e?Object(o["a"])({},u.update,{id:e}):u.create},immediate:!0}},methods:{init:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("create"!==e.action.type){t.next=4;break}e.form=e.$lodash.cloneDeep(d),t.next=15;break;case 4:if("update"!==e.action.type){t.next=15;break}return t.next=7,Object(s["detailSearch"])({id:e.action.id},{loading:!0});case 7:if(i=t.sent,200===i.code){t.next=11;break}return e.form=e.$lodash.cloneDeep(d),t.abrupt("return");case 11:e.form=i.content,e.form.purchase_time=parseInt(1e3*i.content.purchase_time),e.form.last_maintain_time=parseInt(1e3*i.content.last_maintain_time),e.imgList.push({url:i.content.qr_img});case 15:case"end":return t.stop()}}),t)})))()},handleSubmit:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i,n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$refs.form.validate();case 3:if(i=t.sent,i){t.next=6;break}return t.abrupt("return");case 6:return n={purchase_time:parseInt(e.form.purchase_time/1e3),version_id:e.form.version_id,status:e.form.status,last_maintain_time:parseInt(e.form.last_maintain_time/1e3),device_type:e.form.device_type,device_id:e.form.device_id,resume_book:e.form.resume_book,qr_position:e.form.qr_position,qr_img:e.imgList[0].url,comment:e.form.comment},"update"===e.action.type&&(n.id=e.form.id),t.next=10,e.action.submitFunc(n,{loading:!0});case 10:if(a=t.sent,200===a.code){t.next=13;break}return t.abrupt("return");case 13:e.$message({message:"".concat(e.action.title,"成功！"),type:"success",containerType:"drawer",onClose:function(){e.$router.back()}}),t.next=19;break;case 16:return t.prev=16,t.t0=t["catch"](0),t.abrupt("return",t.t0);case 19:case"end":return t.stop()}}),t,null,[[0,16]])})))()},handleImgChange:function(e,t){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=new FormData,n.append("image",e.raw),t.next=4,Object(m["imageUpload"])(n);case 4:if(a=t.sent,200===a.code){t.next=7;break}return t.abrupt("return");case 7:i.imgList.push({url:a.content.link});case 10:case"end":return t.stop()}}),t)})))()},handleRemove:function(e){var t=this.imgList.findIndex((function(t){return t.uid==e.uid}));this.imgList.splice(t,1)},initFactoryCode:function(e){void 0!==e.item&&(this.form.factory_id=e.item.id,this.form.factory_code=e.item.code),this.form.model_id=null,this.form.version_id=null},clearContent:function(e){var t=this;e.forEach((function(e){t.form[e]=null}))}}},p=f,_=(i("caec"),i("2877")),h=Object(_["a"])(p,n,a,!1,null,null,null);t["default"]=h.exports},a128:function(e,t,i){},af03:function(e,t,i){var n=i("d039");e.exports=function(e){return n((function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}))}},caec:function(e,t,i){"use strict";var n=i("a128"),a=i.n(n);a.a}}]);