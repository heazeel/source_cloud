(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["production-data-main-device-drone-force-update-vue"],{5478:function(e,t,r){"use strict";r.r(t);var n,o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("dialog-sc",{ref:"drone-force-update",attrs:{title:"紧急更新",size:"small"},on:{cancel:function(t){return e.$router.back()},submit:e.handleSubmit}},[r("el-form",{ref:"form",staticClass:"form-dialog",attrs:{model:e.form,rules:e.rules,"label-width":"80px"},scopedSlots:e._u([{key:"footer",fn:function(){return[r("button-sc",{attrs:{size:"small",type:"secondary"},on:{click:function(t){return e.$router.back()}}},[e._v(" 取消 ")]),r("button-sc",{attrs:{size:"small"},on:{click:e.handleSubmit}},[e._v(" 更新 ")])]},proxy:!0}])},[r("el-form-item",{staticClass:"block",attrs:{label:"版本",prop:"version"}},[r("el-input",{attrs:{placeholder:"请输入数字"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1),r("el-form-item",{staticClass:"block",attrs:{label:"版本号",prop:"version_no"}},[r("el-input",{model:{value:e.form.version_no,callback:function(t){e.$set(e.form,"version_no",t)},expression:"form.version_no"}})],1)],1)],1)},c=[],s=(r("99af"),r("a9e3"),r("b680"),r("96cf"),r("1da1")),i=r("b5af"),a={version:"",version_no:"",file_name:""},u={name:"ForceUpdate",data:function(){return{form:this.$lodash.cloneDeep(a),rules:{version:[{required:!0,message:"请选择版本"}],version_no:[{required:!0,message:"请选择版本号"}]},processTimeOut:null}},destroyed:function(){this.clearSearchProcess()},methods:{handleSubmit:function(){var e=this;this.$refs.form.validate(function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r){t.next=2;break}return t.abrupt("return");case 2:return n={device_type:e.$route.query.device_type,device_id:Number(e.$route.query.device_id),version:e.form.version,version_no:e.form.version_no,file_name:e.form.file_name},t.next=5,Object(i["forceUpdate"])(n,{loading:!0});case 5:if(o=t.sent,200===o.code){t.next=8;break}return t.abrupt("return");case 8:e.getProcess();case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},getProcess:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(i["percentSearch"])({device_type:e.$route.query.device_type,device_id:Number(e.$route.query.device_id)});case 2:if(r=t.sent,200===r.code){t.next=6;break}return e.clearSearchProcess(),t.abrupt("return");case 6:r.content.percent<100?(n?n.setText("已下载".concat(r.content.percent,"%, 下载速度").concat(r.content.speed.toFixed(2),"kb/s")):n=e.$loading({lock:!0,text:"已下载".concat(r.content.percent,"%, 下载速度").concat(r.content.speed.toFixed(2),"kb/s"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),e.processTimeOut=setTimeout((function(){e.getProcess()}),5e3)):(e.clearSearchProcess(),e.reloadCheck());case 7:case"end":return t.stop()}}),t)})))()},reloadCheck:function(){var e=this;this.$confirm("更新完成，是否重启?","紧急更新",{confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(r,n,o){var c;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("confirm"!==r){t.next=9;break}return t.next=3,Object(i["deviceCmd"])({token:localStorage.getItem("token"),device_type:this.$route.query.device_type,device_id:Number(this.$route.query.device_id)},{isLoading:!0});case 3:if(c=t.sent,200==c.code){t.next=6;break}return t.abrupt("return");case 6:this.$message({type:"success",message:"操作成功!",containerType:"message-box",onClose:function(){o(),e.$router.back()}}),t.next=10;break;case 9:o();case 10:case"end":return t.stop()}}),t,this)})));function r(e,r,n){return t.apply(this,arguments)}return r}()}).catch((function(){}))},clearSearchProcess:function(){n&&n.close(),this.processTimeOut&&(clearTimeout(this.processTimeOut),this.processTimeOut=null)}}},l=u,d=r("2877"),f=Object(d["a"])(l,o,c,!1,null,null,null);t["default"]=f.exports}}]);